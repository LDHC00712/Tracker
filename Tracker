-- // ✅ CONFIG ==============================
local CONFIG = {
    WebhookURL = "https://08cb8c04f339.ngrok-free.app/track", -- แก้ URL webhook ที่นี่
    UpdateInterval = 60, -- หน่วยเป็นวินาที (เช่น ส่งทุก 60 วินาที)
    FarmInterval = 600, -- ระยะเวลาเช็ค farm 10 นาที = 600 วินาที
    FarmThreshold = 10000, -- ฟาร์มขั้นต่ำในช่วง 10 นาที เพื่อถือว่า "✅"
}
-- // =======================================

local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local MarketplaceService = game:GetService("MarketplaceService")
local LocalPlayer = Players.LocalPlayer

local function getCash()
    local cash = 0
    pcall(function()
        local df = LocalPlayer:WaitForChild("DataFolder", 10)
        local currency = df:WaitForChild("Currency", 10)
        cash = currency.Value
    end)
    return cash
end

local altName = LocalPlayer.Name
local gameName = "Unknown"
pcall(function()
    gameName = MarketplaceService:GetProductInfo(game.PlaceId).Name
end)

local initialCash = getCash()
local cash10MinAgo = initialCash
local last10Min = os.time()

local function sendUpdate()
    local currentCash = getCash()
    local now = os.time()

    -- อัปเดตค่าล่าสุดทุก CONFIG.FarmInterval วินาที
    if now - last10Min >= CONFIG.FarmInterval then
        cash10MinAgo = currentCash
        last10Min = now
    end

    local earnedCash = currentCash - initialCash
    local gain10Min = currentCash - cash10MinAgo
    local farmStatus = (gain10Min >= CONFIG.FarmThreshold) and "✅" or "❌"

    local data = {
        name = altName,
        game = gameName,
        currentCash = currentCash,
        initialCash = initialCash,
        earnedCash = earnedCash,
        timestamp = os.date("%Y-%m-%d %H:%M:%S"),
        farm = farmStatus
    }

    local jsonData = HttpService:JSONEncode(data)

    pcall(function()
        if request then
            request({
                Url = CONFIG.WebhookURL,
                Method = "POST",
                Headers = {["Content-Type"] = "application/json"},
                Body = jsonData
            })
        else
            HttpService:PostAsync(CONFIG.WebhookURL, jsonData, Enum.HttpContentType.ApplicationJson)
        end
    end)
end

sendUpdate()

task.spawn(function()
    while true do
        task.wait(CONFIG.UpdateInterval)
        sendUpdate()
    end
end)
